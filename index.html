!DOCTYPE html
html lang=es
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no
    titleTe quiero Duna )title
    link href=httpsfonts.googleapis.comcss2family=Fredoka+One&family=Patrick+Hand&display=swap rel=stylesheet
    
    script src=httpswww.gstatic.comfirebasejs8.10.1firebase-app.jsscript
    script src=httpswww.gstatic.comfirebasejs8.10.1firebase-database.jsscript

    style
         --- TU ESTILO ORIGINAL INTACTO --- 
        body {
            margin 0; padding 0; display flex; justify-content center; align-items center;
            height 100vh; min-height -webkit-fill-available; overflow hidden;
            font-family 'Fredoka One', cursive;
             Aqu칤 est치 tu imagen en base64 original 
            background-image url('dataimagejpeg;base64,9j4AAQSkZJRgABAQEASABIAAD2wCEAAwMDAwMDA0ODg0SExETEhsYFhYYGygdHx0fHSg9Ji0mJi0mPTZCNTI1QjZhTERETGFwXllecIh...'); 
            background-size cover; background-position center center;
            background-repeat no-repeat; background-attachment fixed;
        }
        .envelope-wrapper { position relative; width 300px; height 200px; cursor pointer; filter drop-shadow(0 10px 20px rgba(0,0,0,0.3)); transition transform 0.3s; }
        .envelope-wrapperhover { transform scale(1.02); }
        .wing { position absolute; top 30%; width 60px; height 40px; background #fff; border-radius 50%; z-index -1; transition all 0.5s ease; }
        .wingafter { content ''; position absolute; width 40px; height 30px; background #fff; border-radius 50%; }
        .wing-left { left -40px; transform rotate(-15deg); }
        .wing-leftafter { bottom -10px; left -10px; }
        .wing-right { right -40px; transform rotate(15deg); }
        .wing-rightafter { bottom -10px; right -10px; }
        .envelope { position relative; width 100%; height 100%; background #f0f0f0; border-radius 10px; box-shadow inset 0 0 20px rgba(0,0,0,0.05); }
        .pocket { position absolute; bottom 0; left 0; width 0; height 0; border-left 150px solid transparent; border-right 150px solid transparent; border-bottom 120px solid #ffffff; border-radius 0 0 10px 10px; z-index 3; }
        .flap { position absolute; top 0; left 0; width 0; height 0; border-left 150px solid transparent; border-right 150px solid transparent; border-top 120px solid #f8f8f8; transform-origin top; transition all 0.6s ease-in-out; z-index 4; border-radius 10px 10px 0 0; }
        .heart { position absolute; top 55%; left 50%; width 30px; height 30px; background #ff4757; transform translate(-50%, -50%) rotate(45deg); z-index 5; transition all 0.4s ease; box-shadow 0 2px 5px rgba(0,0,0,0.2); animation heartbeat 1.5s infinite; }
        .heartbefore, .heartafter { content ''; position absolute; width 30px; height 30px; background #ff4757; border-radius 50%; }
        .heartbefore { top -18px; left 0; }
        .heartafter { left -18px; top 0; }
        @keyframes heartbeat { 0%, 100% { transform translate(-50%, -50%) rotate(45deg) scale(1); } 50% { transform translate(-50%, -50%) rotate(45deg) scale(1.1); } }
        .letter { position absolute; bottom 0; left 50%; transform translateX(-50%); width 80%; height 70%; background #fff; padding 20px; box-sizing border-box; border-radius 5px; z-index 2; transition all 0.6s ease-in-out; display flex; flex-direction column; align-items center; text-align center; font-family 'Patrick Hand', cursive; color #555; opacity 0; }
        .letter h2 { margin 0; color #ff4757; font-size 1.5rem; }
        .letter p { margin 10px 0 0; line-height 1.3; font-size 1rem; }
        .envelope-wrapper.open .flap { transform rotateX(180deg); z-index 1; }
        .envelope-wrapper.open .heart, .envelope-wrapper.open .wing { opacity 0; transform scale(0); }
        .envelope-wrapper.open .letter { bottom 70px; z-index 6; height 220px; width 90%; opacity 1; box-shadow 0 5px 15px rgba(0,0,0,0.2); transition-delay 0.1s; }
        @media (max-height 500px) { .envelope-wrapper { transform scale(0.8); } .envelope-wrapperhover { transform scale(0.82); } }

         --- ESTILOS NUEVOS PARA EL HISTORIAL (No afectan al sobre) --- 
        .history-btn {
            position fixed; bottom 20px; left 20px;
            background rgba(255, 255, 255, 0.8);
            border none; padding 10px 15px; border-radius 20px;
            font-family 'Fredoka One', cursive; color #ff4757;
            cursor pointer; box-shadow 0 2px 10px rgba(0,0,0,0.1);
            z-index 100;
        }
        .history-modal {
            display none; position fixed; top 0; left 0; width 100%; height 100%;
            background rgba(0,0,0,0.5); z-index 200;
            justify-content center; align-items center;
        }
        .history-content {
            background white; width 80%; max-width 300px;
            border-radius 15px; padding 20px;
            max-height 60vh; overflow-y auto;
            font-family 'Patrick Hand', cursive;
        }
        .history-item {
            padding 10px; border-bottom 1px solid #eee; cursor pointer;
        }
        .history-itemhover { background #fff0f3; }
        .close-history {
            background #ff4757; color white; border none;
            padding 5px 10px; border-radius 5px; margin-top 10px;
            width 100%; cursor pointer; font-family 'Fredoka One', cursive;
        }
    style
head
body

    button class=history-btn onclick=openHistory()游눏 Cartas Anterioresbutton

    div class=history-modal id=historyModal
        div class=history-content
            h3 style=color#ff4757; margin-top0; text-aligncenter;Tus Cartash3
            div id=historyListCargando...div
            button class=close-history onclick=closeHistory()Cerrarbutton
        div
    div

    div class=envelope-wrapper id=envelope
        div class=wing wing-leftdiv
        div class=wing wing-rightdiv
        div class=envelope
            div class=flapdiv
            div class=pocketdiv
            div class=heartdiv
            div class=letter
                h2 id=letterTitleCargando...h2
                p id=letterTextEsperando carta...p
                p style=margin-top auto; font-size 0.9rem;Toca para cerrarp
            div
        div
    div

    script
         --- 1. CONFIGURACI칍N DE FIREBASE ---
        const firebaseConfig = {
  		apiKey: "AIzaSyAXhQzt9zenYwsceZBZ2D3939EykqB-HAE",
  		authDomain: "cartas-amor-941ab.firebaseapp.com",
  		projectId: "cartas-amor-941ab",
  		storageBucket: "cartas-amor-941ab.firebasestorage.app",
  		messagingSenderId: "987328078744",
  		appId: "1:987328078744:web:0fa7cc713e4026cfe581ed",
  		measurementId: "G-Q73LNTKGD2"
        };

         Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allLetters = [];

         --- 2. LEER CARTAS AL INICIAR ---
        const lettersRef = database.ref('cartas');
        
        lettersRef.on('value', (snapshot) = {
            const data = snapshot.val();
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';  Limpiar lista
            allLetters = [];

            if (data) {
                 Convertir objeto a array y ordenar (la m치s nueva primero)
                const lettersArray = Object.keys(data).map(key = data[key]);
                 Ordenar por timestamp descendente
                lettersArray.sort((a, b) = b.timestamp - a.timestamp);
                allLetters = lettersArray;

                 2.1 Mostrar la 칔LTIMA carta en el sobre autom치ticamente
                if (lettersArray.length  0) {
                    loadLetterIntoEnvelope(lettersArray[0]);
                } else {
                    document.getElementById('letterTitle').innerText = Hola Amor;
                    document.getElementById('letterText').innerText = A칰n no hay cartas nuevas.;
                }

                 2.2 Llenar el historial
                lettersArray.forEach((letter, index) = {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    const date = new Date(letter.timestamp).toLocaleDateString();
                    div.innerHTML = `strong${date}strong - ${letter.title}`;
                    div.onclick = () = {
                        loadLetterIntoEnvelope(letter);
                        closeHistory();
                         Si est치 abierto, hacemos un efecto visual
                        if(envelope.classList.contains('open')){
                            envelope.classList.remove('open');
                            setTimeout(() = envelope.classList.add('open'), 600);
                        }
                    };
                    historyList.appendChild(div);
                });
            } else {
                historyList.innerHTML = 'p style=text-aligncenterNo hay cartas guardadas.p';
            }
        });

        function loadLetterIntoEnvelope(letter) {
            document.getElementById('letterTitle').innerText = letter.title;
            document.getElementById('letterText').innerText = letter.text;
        }

         --- 3. L칍GICA DEL SOBRE (Tuya original) ---
        const envelope = document.getElementById('envelope');
        envelope.addEventListener('click', toggleEnvelope);
        envelope.addEventListener('touchstart', toggleEnvelope, {passive true});

        function toggleEnvelope(e) {
            if (e.type === 'touchstart') e.preventDefault(); 
            envelope.classList.toggle('open');
        }

         --- 4. L칍GICA DEL HISTORIAL ---
        function openHistory() { document.getElementById('historyModal').style.display = 'flex'; }
        function closeHistory() { document.getElementById('historyModal').style.display = 'none'; }
    script
body
html